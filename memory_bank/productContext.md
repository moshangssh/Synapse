# 产品背景

本项目旨在创建一个使用 Tauri, React, 和 FastAPI 构建的桌面应用程序。

## DaVinci Resolve 字幕提取应用 (2025-07-23)

**项目目标:**
开发一个采用前后端分离架构的独立应用程序。该应用的后端负责连接到正在运行的 DaVinci Resolve 实例，并从当前活动时间线的指定字幕轨道中提取所有字幕条目。前端则以一个清晰的MUI表格界面来实时展示和刷新这些字幕数据。

**技术架构要求:**
1.  **后端:** 使用 Python + FastAPI 实现。后端将作为服务端，封装所有与 DaVinci Resolve Scripting API 的交互逻辑。
2.  **前端:** 一个基于 React + Tauri + MUI 技术的用户界面，用于数据显示和用户交互。
3.  **通信协议:** 后端需提供一个 RESTful API 接口，供前端调用以获取字幕数据。

**核心功能流程:**
1.  **连接管理:** 应用程序启动时，后端主动尝试连接到本地正在运行的 DaVinci Resolve 实例。
2.  **API 端点:** 后端至少需要实现一个 API 端点 (例如: `GET /api/v1/subtitles`) 用于提供字幕数据。
3.  **数据提取逻辑:**
    *   当 API 端点被调用时，后端脚本需要执行以下操作：
        a. 获取 DaVinci Resolve 的当前项目 (Project)。
        b. 获取项目中的当前活动时间线 (Timeline)。
        c. 定位到时间线上的第一个字幕轨道 (Subtitle Track)。
        d. 遍历该轨道上的所有字幕片段 (Subtitle Items)。
        e. 对每个字幕片段，精确提取其**起始时间码 (Start Timecode)**、**结束时间码 (End Timecode)** 以及**字幕文本内容 (Text)**。
4.  **数据格式化:** 后端将提取到的数据整理成一个 JSON 对象数组，每个对象代表一条字幕。

**前端界面要求:**
1.  **数据显示:**
    *   设计一个表格 (Table) 来展示字幕数据。
    *   表格应至少包含以下列：“序号”、“起始时间码”、“结束时间码”、“字幕内容”。
2.  **用户交互:**
    *   提供一个“刷新”按钮，点击后会重新从 DaVinci Resolve 获取最新的字幕数据并更新表格。
    *   在界面上明确显示与 DaVinci Resolve 的连接状态（例如：“已连接”、“连接中”、“错误：未找到 DaVinci Resolve 实例”）。
    *   **查找与替换:**
        *   提供输入框用于输入查找内容和替换内容。
        *   提供“查找下一个”、“全部替换”按钮。
        *   高亮显示当前匹配的查找结果。

**数据结构定义 (JSON 示例):**
```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "startTimecode": "01:00:02:10",
      "endTimecode": "01:00:05:15",
      "text": "这是第一条字幕。"
    },
    {
      "id": 2,
      "startTimecode": "01:00:06:00",
      "endTimecode": "01:00:09:20",
      "text": "这是第二条字幕，用于演示。"
    }
  ]
}
```

**错误处理机制:**
*   **Resolve 未运行:** 如果后端无法连接到 DaVinci Resolve，API 应返回明确的错误信息和状态码（例如 503 Service Unavailable）。
*   **无打开项目/时间线:** 如果 Resolve 正在运行但没有打开的项目或活动时间线，API 应返回相应的状态信息。
*   **无字幕轨道:** 如果当前时间线上不存在字幕轨道，API 应返回一个空的数据数组。

**核心约束:**
**此应用程序必须作为一个独立的进程运行**，而不是作为插件在 DaVinci Resolve 内部执行。它需要自行管理与 Resolve 应用程序的生命周期和通信连接。在设计时请务必充分考虑此运行模式。